{% load static %}
{% load humanize %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vuvu - Wallet</title>
    {% include 'users/includes/header.html' %}
</head>
<body>
    <!-- Transaction Form -->
     {% csrf_token %}
    <div class="main-content transasction-page" id="transaction-form" style="display: block;">
        <div class="top-section">
            <!-- Header -->
            <div class="services-header">
                {% csrf_token %}
                <a href="{% url 'dashboard' %}">
                    <div class="back-nav">
                        <svg width="18px" height="18px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M11.7071 4.29289C12.0976 4.68342 12.0976 5.31658 11.7071 5.70711L6.41421 11H20C20.5523 11 21 11.4477 21 12C21 12.5523 20.5523 13 20 13H6.41421L11.7071 18.2929C12.0976 18.6834 12.0976 19.3166 11.7071 19.7071C11.3166 20.0976 10.6834 20.0976 10.2929 19.7071L3.29289 12.7071C3.10536 12.5196 3 12.2652 3 12C3 11.7348 3.10536 11.4804 3.29289 11.2929L10.2929 4.29289C10.6834 3.90237 11.3166 3.90237 11.7071 4.29289Z" fill="#000000"/>
                        </svg>
                        <p>Back</p>
                    </div>
                </a>                
                <div class="service-info">
                    <p>Wallet</p>
                </div>            
            </div>
            <div class="wallet-summary">
                <p class="header">Available VPoints</p>
                <p class="balance">{{user.wallet_balances.balance|intcomma}}</p>
            </div>
        </div>
        <p class="section-header">Top Up Wallet</p>
        <div class="funding-option">
            <p>Use a temporary account number to top up your VPoints balance. Generated account should <strong>only be used once</strong> and are only valid for <strong>15 minutes</strong> </p>            
            <button class="primary-btn" onclick="" id="oneTimeBTN">Top Up</button>
        </div>
        <div class="funding-option">
            <p>Top up your VPoints balance using a permernent virtual account atteched to your profile. You will need to provide <strong>BVN or NIN</strong> to generate virtual accounts</p>            
            <button class="primary-btn" onclick="" id="virtualAccBTN">Top Up</button>
        </div>
        <p class="section-header">Recent Wallet Activities</p>
        {% for activity in walletActivities%}
        <div class="activity-container {{activity.event_type|lower}}" >
            <div class="left">
                <div class="icon-box">
                    <svg width="32px" height="32px"  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.0005 15.9995L15.0005 11.9995M15.0005 11.9995L11.0005 7.99951M15.0005 11.9995H3.00049M11.0005 2.99951H17.7997C18.9198 2.99951 19.4799 2.99951 19.9077 3.2175C20.284 3.40925 20.59 3.71521 20.7817 4.09153C20.9997 4.51935 20.9997 5.07941 20.9997 6.19951V17.7995C20.9997 18.9196 20.9997 19.4797 20.7817 19.9075C20.59 20.2838 20.284 20.5898 19.9077 20.7815C19.4799 20.9995 18.9198 20.9995 17.7997 20.9995H11.0005" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>                
                </div>
                <div class="info">
                    <p class="header">{{activity.transaction_type}}</p>
                    <p class="tag">{{activity.created}}</p>
                </div>
            </div>
            <div class="right">
                <div class="info">
                    <p class="header">VP{{activity.amount|intcomma}}</p>
                    <p class="tag">Settled</p>
                </div>
            </div>
        </div>
        {% endfor %}
        <div class="history-link">
            <a href="javascript:void(0)">View Full History</a>
        </div>
        
        
         <!-- Bottom Nav -->
        {% include 'users/includes/bottom-navs.html' %}   
        
        <!-- One Time Topup -->
        <div class="setting-modal" id="oneTimeTopup">
            {% csrf_token %}  
            <div class="content">
                <!-- Top up amount -->
                <div class="form-container" id="topUpAmount" style="display: block;">
                    <p class="header">Top Up Points</p>
                    <form action="">
                        <div class="input-group">
                            <input type="text" id="amount" inputmode="numeric" placeholder="How much?">
                            <p class="note">1VPoint = &#8358;1 </p>
                        </div>
                        <button class="primary-btn disabled" id="proceedOneTime" disabled>Proceed</button>
                    </form>
                </div>
                <!-- Step 2 Account details -->
                <div class="account-container" id="oneTimeAccountDetails" style="display: none;">
                    <p class="header">Top Up Points</p>
                    <p class="tag">You will  be charged 10VP for this top up</p>
                    <div class="account-info">
                        <div class="left">
                            <p class="title">Account Number</p>
                            <P class="account-number" id="oneTimeAccNo"></P>
                        </div>
                        <div class="right">
                            <button id="copyOneTimeAcc">Copy</button>
                            <p class="copy-indicator" id="oneTimeCopyIndicator">Copied</p>
                        </div>
                    </div>
                    <div class="bank-details" id="sfbBankDetals" >
                        <div class="item">
                            <div class="icon-box">
                                <img src="{% static 'users/images/safehaven.jpg' %}" alt="">
                            </div>
                            <div class="details">
                                <p class="title">Bank Name</p>
                                <p class="data">SafeHaven MFB</p>
                            </div>
                        </div>
                        <div class="item">
                            <div class="icon-box">
                                <img src="{% static 'users/images/vuvu-logo.png' %}" alt="">vuvu-logo
                            </div>
                            <div class="details">
                                <p class="title">Account Name</p>
                                <p class="data">Vuvu Checkout</p>
                            </div>
                        </div>
                    </div>
                    <button class="primary-btn" id="confirmTopUp" onclick="">Confirm Payment</button>
                </div>
                <!-- Step 3 awaiting payment -->
                <div class="feedback-container" id="oneTimeTopupConfirmation" style="display: none;">
                    <div class="svg-container">
                        <svg fill="#000000" width="100px" height="100px" viewBox="0 0 24 24" id="caution-sign-square" xmlns="http://www.w3.org/2000/svg" class="icon line">
                            <line id="primary-upstroke" x1="11.95" y1="16.5" x2="12.05" y2="16.5" style="fill: none; stroke: rgb(201, 195, 9); stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.95;"></line>
                            <path id="primary" d="M3,4A1,1,0,0,1,4,3H20a1,1,0,0,1,1,1V20a1,1,0,0,1-1,1H4a1,1,0,0,1-1-1Zm9,8V7" style="fill: none; stroke: rgb(201, 195, 9); stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.5;"></path>
                        </svg>
                    </div>
                    <!-- Payment Pending -->
                    <div class="reset-feedback waiting" id="oneTimeTopupPending">
                        <p>Top Up Pending</p>
                        <small>We are still waiting for your funds <br>please stay on page.</small>
                        <div id="ten-countdown" class="timer-div"></div>
                        <input type="text" value="" id="accountID" hidden>
                    </div>
                    <!-- Payment not receieved -->
                    <div class="reset-feedback payment-pending" id="oneTimeTopupExpired" style="display: none;">
                        <p>Top Up Pending</p>
                        <small>Ooops! your funds did not get to us on time.<br>If we receive it before account expiry <br>you will be credited with your VPoints .</small>
                        <div id="ten-countdown" class="timer-div"></div>
                        <input type="text" value="{{accountDetails.accountID}}" id="accountID" hidden>
                    </div>  
                    <a href="{% url 'dashboard' %}" class="primary-btn" id="closePasswordChange"> Close</a>
                 </div>
                
                 <!-- Step 4 payment Successful -->
                <div class="feedback-container" id="oneTimeTopupSuccess" style="display: none;">
                    <div class="svg-container">
                        <svg width="100px" height="100px" viewBox="0 0 1024 1024" class="icon"  version="1.1" xmlns="http://www.w3.org/2000/svg">
                            <path d="M905.92 237.76a32 32 0 0 0-52.48 36.48A416 416 0 1 1 96 512a418.56 418.56 0 0 1 297.28-398.72 32 32 0 1 0-18.24-61.44A480 480 0 1 0 992 512a477.12 477.12 0 0 0-86.08-274.24z" fill="green" />
                            <path d="M630.72 113.28A413.76 413.76 0 0 1 768 185.28a32 32 0 0 0 39.68-50.24 476.8 476.8 0 0 0-160-83.2 32 32 0 0 0-18.24 61.44zM489.28 86.72a36.8 36.8 0 0 0 10.56 6.72 30.08 30.08 0 0 0 24.32 0 37.12 37.12 0 0 0 10.56-6.72A32 32 0 0 0 544 64a33.6 33.6 0 0 0-9.28-22.72A32 32 0 0 0 505.6 32a20.8 20.8 0 0 0-5.76 1.92 23.68 23.68 0 0 0-5.76 2.88l-4.8 3.84a32 32 0 0 0-6.72 10.56A32 32 0 0 0 480 64a32 32 0 0 0 2.56 12.16 37.12 37.12 0 0 0 6.72 10.56zM230.08 467.84a36.48 36.48 0 0 0 0 51.84L413.12 704a36.48 36.48 0 0 0 51.84 0l328.96-330.56A36.48 36.48 0 0 0 742.08 320l-303.36 303.36-156.8-155.52a36.8 36.8 0 0 0-51.84 0z" fill="green" />
                        </svg>
                    </div>
                    <div class="feedback" id="">
                        <p>Your VPoints top up was successful <br><strong id="pointsAdded"></strong>VPoints was added to your wallet.</p>
                    </div> 
                    <a href="{% url 'dashboard' %}" class="primary-btn" id="closePasswordChange"> Close</a>
                 </div>
                
            </div>
        
        </div>
        <!-- Virtual Account -->
        <div class="setting-modal" id="virtuaAccModal" style="display: block;">
            {% csrf_token %}  
            <div class="content">
                <div class="form-container" id="" style="display: block;">                    
                    <div class="virtual-account-container">
                        <div class="nav-tabs">
                            <button class="vacc-nav active" onclick="">SafeHaven MFB</button>
                            <button class="vacc-nav" onclick="">9Payment SB</button>
                        </div>
                        <div class="sfb-container">
                            <!-- Generate Account -->
                            <div class="generate-account" id="generateAccount" style="display: block;">
                                <div class="note">
                                    <p class="stamp-duty">Deposits below &#8358;1,000: &#8358;10 stamp duty</p>
                                    <p class="stamp-duty">Deposits between &#8358;1,000 - 5000: &#8358;25 stamp duty</p>
                                    <p class="stamp-duty">Deposits &#8358;5,000 above : &#8358;50 stamp duty</p>
                                </div>
                                {% if user.has_safeHavenAccount == False %}
                                <button class="primary-btn" id="generate-sfb">Proceed</button>
                                {% else %}
                                <!-- Account Details -->
                                <div class="account-container virtual" id="oneTimeAccountDetails" style="display: block;">                                
                                    <div class="account-info">
                                        <div class="left">
                                            <p class="title">Account Number</p>
                                            <P class="account-number" id="sfbAccNo">{{user.safeHavenAccount_account_number}}</P>
                                        </div>
                                        <div class="right">
                                            <button id="copySfbAcc">Copy</button>
                                            <p class="copy-indicator" id="sfbcopyIndicator">Copied</p>
                                        </div>
                                    </div>
                                    <div class="bank-details" id="sfbBankDetals" >
                                        <div class="item">
                                            <div class="icon-box">
                                                <img src="{% static 'users/images/safehaven.jpg' %}" alt="">
                                            </div>
                                            <div class="details">
                                                <p class="title">Bank Name</p>
                                                <p class="data">SafeHaven MFB</p>
                                            </div>
                                        </div>
                                        <div class="item">
                                            <div class="icon-box">
                                                <img src="{% static 'users/images/vuvu-logo.png' %}" alt="">vuvu-logo
                                            </div>
                                            <div class="details">
                                                <p class="title">Account Name</p>
                                                <p class="data">Vuvu Checkout</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            



                            <!-- KYC Form-->
                            <div class="form-container" id="KYCForm" style="display: none;">
                                <p class="header" style="text-align: left;">Identity Verification</p>
                                <p class="kyc-note">Please provide some information about yourself. We <br>we use this information to protect your account and for <br>compliance purpose.</p>
                                <p class="kyc-note" style="margin-top: 10px;">The Full name and DOB must be as shown on your BVN</p>
                                <form action="" id="kyc-form" method="post">
                                    {% csrf_token%}
                                    <div class="input-group">
                                        <select name="id_type" id="id_type">
                                            <option value="" disabled selected>Identity Type</option>  
                                            <option value="BVN">BVN</option>  
                                            <!-- <option value="NIN">NIN</option>             -->
                                        </select>
                                        <div class="validation-container" id="idTypeValidation" >
                                            <p class="input-validation" id="idTypeError"></p> 
                                        </div>
                                          
                                    </div>
                                                         
                                    <!-- ID Number -->
                                    <div class="input-group" id="">
                                        <input type="text" id="id_num" inputmode="numeric" name="id_num"  placeholder="Identity No." class="input-element">                            
                                    </div>
                                    <div class="validation-container" id="idNumValidation" >
                                        <p class="input-validation" id="idNumError"></p> 
                                    </div>
                                    
            
                                    <div class="input-group " id="">
                                        <input type="text" id="first_name" name="first_name"  placeholder="First Name" class="input-element">                            
                                        <div class="validation-container" id="firstNameValidation">
                                            <p class="input-validation" id="firstNameError"></p> 
                                        </div>
                                    </div>
                                    
                                    
                                    <div class="input-group " id="">
                                        <input type="text" id="last_name" name="last_name"   placeholder="Last Name" class="input-element">                            
                                        <div class="validation-container" id="lastNameValidation">
                                            <p class="input-validation" id="lastNameError"></p>
                                        </div>
                                    </div>                        
                                    
                                    <!-- Date of birth -->
                                    <div class="input-group " id="">
                                        <div class="date-of-birth">
                                            <div class="input-group">
                                                <select name="date-day" id="date-day">
                                                    <option value="" selected >Day</option>  
                                                    <option value="01" >01</option><option value="02" >02</option><option value="03" >03</option><option value="04" >04</option><option value="05" >05</option><option value="06" >06</option><option value="07" >07</option><option value="08" >08</option><option value="09" >09</option><option value="10" >10</option><option value="11" >11</option><option value="12" >12</option><option value="13" >13</option><option value="14" >14</option><option value="15" >15</option><option value="16" >16</option><option value="17" >17</option><option value="18" >18</option><option value="19" >19</option><option value="20" >20</option><option value="21" >21</option><option value="22" >22</option><option value="23" >23</option><option value="24" >24</option><option value="25" >25</option><option value="26" >26</option><option value="27" >27</option><option value="28" >28</option><option value="29" >29</option><option value="30" >30</option><option value="31" >31</option>
                                                </select>
                                            </div>
                                            <div class="input-group">
                                                <select name="date-month" id="date-month">
                                                    <option value="" selected >Month</option>
                                                    <option value="Jan" >January</option>
                                                    <option value="Feb" >February</option>
                                                    <option value="Mar" >March</option>
                                                    <option value="Apr" >April</option>
                                                    <option value="May" >May</option>
                                                    <option value="Jun" >June</option>
                                                    <option value="Jul" >July</option>
                                                    <option value="Aug" >August</option>
                                                    <option value="Sept" >September</option>
                                                    <option value="Oct" >October</option>
                                                    <option value="Nov" >November</option>
                                                    <option value="Dec" >December</option>         
                                                </select>
                                            </div>
                                            <div class="input-group">
                                                <select name="date-year" id="date-year">
                                                    <option value="" selected >Year</option>            
                                                </select>
                                            </div>
                                        </div>
                                        <div class="validation-container" id="dobValidation" >
                                            <p class="input-validation" id="dobError">please set a valid date of birth</p>
                                        </div>
                                    </div>
                                    
                                    <div class="security-agent">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M6 10V8C6 4.69 7 2 12 2C17 2 18 4.69 18 8V10" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M12 18.5C13.3807 18.5 14.5 17.3807 14.5 16C14.5 14.6193 13.3807 13.5 12 13.5C10.6193 13.5 9.5 14.6193 9.5 16C9.5 17.3807 10.6193 18.5 12 18.5Z" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M17 22H7C3 22 2 21 2 17V15C2 11 3 10 7 10H17C21 10 22 11 22 15V17C22 21 21 22 17 22Z" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <p>Secured by SafeHaven MFB</p>
                                    </div>

                                    <!-- Backend Error -->
                                    <div class="error-feedback" id="KYCError">
                                        <div class="transaction-error">
                                            <svg fill="#FFF" width="32px" height="32px" viewBox="0 0 24 24" id="caution-sign-circle" xmlns="http://www.w3.org/2000/svg" class="icon line">
                                                <line id="primary-upstroke" x1="11.95" y1="16.5" x2="12.05" y2="16.5" style="fill: none; stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.95;"></line>
                                                <path id="primary" d="M3,12a9,9,0,0,1,9-9h0a9,9,0,0,1,9,9h0a9,9,0,0,1-9,9h0a9,9,0,0,1-9-9Zm9,0V7" style="fill: none; stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.5;"></path>
                                            </svg>
                                            <p class="error-message" id="error-message"></p>
                                        </div>
                                    </div>                                   
                                    
                                    <!-- Button -->
                                    <button class="primary-btn" id="submit-kyc" onclick="">Verify KYC</button>                                                          
                               </form>
                               
                            </div>
                            <!-- OTP VRTIFICATION-->
                            <div class="form-container" id="OTPVerification" style="display: none;">
                                <p class="header" style="text-align: left;">OTP Verification</p>
                                <p class="kyc-note">Please enter the OTP code sent to the phone number <br>registered on your BVN </p>
                                <!-- <p class="kyc-note" style="margin-top: 10px;">The Full name and DOB must be as shown on your BVN</p> -->
                                <div class="pin-container">
                                    <div id="PINWrapper" ></div>
                                </div>
                                <div class="error-feedback" id="OTPErrorContainer">
                                    <div class="transaction-error">
                                        <svg fill="#FFF" width="32px" height="32px" viewBox="0 0 24 24" id="caution-sign-circle" xmlns="http://www.w3.org/2000/svg" class="icon line">
                                            <line id="primary-upstroke" x1="11.95" y1="16.5" x2="12.05" y2="16.5" style="fill: none; stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.95;"></line>
                                            <path id="primary" d="M3,12a9,9,0,0,1,9-9h0a9,9,0,0,1,9,9h0a9,9,0,0,1-9,9h0a9,9,0,0,1-9-9Zm9,0V7" style="fill: none; stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.5;"></path>
                                        </svg>
                                        <p class="error-message" id="OTPError"></p>
                                    </div>
                                </div>
                                <button class="primary-btn disabled" id="submit-kyc" onclick="" disabled>Submit</button> 
                            </div>
                            
                        </div>

                    </div>
                    
                </div>
                
                
            </div>
        
        </div>

        <!-- Page Preloader -->
        <div class="loader-overlay">
            <div class="loader"></div>
        </div>
    </div>

    



    

    <script src="{% static 'users/js/wallet.js' %}"></script>
    <script src="{% static 'users/js/virtual-account.js' %}"></script>
    
</body>
</html>